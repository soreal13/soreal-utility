
## 작업 일지 이야기

읽어도 되고 안 읽어도 되는.  
누군가에게는 도움이 되었으면 하는 삽질 일지.


## 파일 추출 

- PSP ISO ROM 구하기
  https://cdromance.com/  
  https://www.romsgames.net

여기를 사용했으나 단순히 UMD 에서 파일을 추출하기 귀찮았을 뿐 퀸로제 사의 모든 게임 UMD는 소장하고 있습니다.

- ks 파일 추출하는 순서

1. iso 압축 푼다.
2. PSP_GAME > USRDIR > DATA 의 보통 DATA0.cpk 파일에 ks 파일이 들어있음.
3. CPKBrowser 이라는 파일을 통해 all extract 한다. 

그런데 여기서 문제. 대략 2013년 이후 부터의 퀸로제사 게임은 .cpk 확장자가 아닌 .qpk/.qpi 확장자 이다......ㅠㅠㅠㅠㅠㅠㅠㅠ



## 파일 컨버팅


### 인코딩 문제

- 중국어 GBK

대륙 언니들께서 풀어주신 파일 인코딩이 GBK로 되어있다.  
자바스크립트 라이브러리를 사용해 보았으나 실패.  
가장 확실한 방법은 VScode에서 UTF로 열린 파일을 GBK로 인코딩해서 열면 정상적인 문자가 나오고 해당 내용을 복사해서 다시 UTF 인코딩한 상태의 문서에 붙여넣는 것.  
아라로즈의 경우가 해당 상황이었는데 하필 아라로즈 스크립트 파일이 잘게 쪼개져 있어 무려 1800개... 손으로 하거나 매크로 돌려서 할 수 있는 수준이 아니다.  

VSCode의 Extension 에서 GBK to utf8 다운 수가 가장 많은 확장을 설치하고 폴더 내 파일을 전체 한번에 컨버팅 시켰다.  
컨버팅이 전부 되었으면 좋았을텐데... 
1800개중 약 1000개는 성공하고 800개는 실패해버리는 상황 발생.  
오히려 성공한 파일과 성공하지 못한 파일이 뒤죽박죽 섞여버려서 일괄 처리하기 더 난감해졌다.  

다행히 해당 extension은 실패한 파일과 성공한 파일의 결과를 .md 파일로 생성해줬는데... 
거기서 실패한 파일들을 정규식으로 문자배열에 담아 자바단 소스를 이용(customizeservice의 curl 메소드) 파일 이동을 시켰다.
그리고 나머지 800여개의 파일은 매크로를 통해 일일이 변환시켰다.ㅋ (환장)  
변환의 단계는 이러하다. (VScode 기본 단축키 기준)

1. 첫화면은 이미 작업된 페이지로 세팅.
2. ctrl+0으로 목록 창 선택 -> (아래) 키 한번 눌러 다음 파일 선택 -> (엔터)
3. ctrl+shift+P -> encode(혹은 그냥 바로 뜨면 엔터 두번) -> GBK 입력 -> (엔터) 
4. 정상적으로 나온 창에서 ctrl+a (전체선택) -> ctrl+v (복사)
5. ctrl+shift+p(명령팔레트) -> 다시 utf-8로 인코딩
6. ctrl+a -> ctrl+v (붙여넣기)
7. ctrl+s (저장)

매크로의 단계는 위와 같다.... 800개 파일 기준 대략 3시간 소요했다. 도대체 이게 4차산업혁명시대 알파고와 파파고의 시대가 맞는 걸까.. 90년대 노가다와 뭐가 다른걸까... 
내 실력의 문제인가... 이게 과연 맞는 건가... 컴퓨터는 대체 언제 나한테 도움이 될 만큼 똑똑해질까... 대체 나는 왜 이런 삽질을 하는 걸까.... 오만 생각을 다하면서 파일을 결국 변환했다. 

참고 플러그인 GBKtoUTF8 https://github.com/buuug7/gbk2utf8-vscode



- 일본어 SHIFT-JIS

중국어 GBK 과 똑같은 상황이... 다이아나라의 앨리스 스크립트 파일에서도 나타났다... 이번엔 SHIFT_JIS로.... 하... 
현업에서 euc-kr도 그렇고 인코딩 문제 나타날때마다 제발 바라게 된다. 제에에에에발 UTF-8로 통일해주세요... 진시황 같은 사람 컴퓨터 계에 나와서 강제로 통일 시켜야 한다.. 
나폴레옹이 유럽을 점령하며 도량형을 퍼뜨렸듯이 이건 ㄹㅇ 전쟁이든 뭐든 정복해서 한번에 누가 통일을 해야지....ㅠㅠㅠ 
아무튼 어쩔 수 없다. 컴퓨터 기본 세팅 따라 그냥 그렇게 저장하신 것이리라... 애초에 스크립트 파일을 추출해서 뿌려주시는 것만으로도 감사해야 할 처지인 것을.

이번엔 대륙의 언어가 아니라 그런지 따로 vscode에 마땅한 일괄처리 extension 도 없었다. 해당 문제 해결 자체는 위의 GBK 매크로 방식으로 하면 되긴 했다. 그렇다고 하나하나 매크로 돌리는건 또 싫어서(귀찮아서...)  
1)iconv를 깔아서 해결해보려고 함 2)자바단 소스로 또 해결해보고자 함...

1)을 위해 참고한 사이트 iconv : https://technote.kr/206  
2)를 위해 참고한 사이트 SHIFT-JIS to UTF-8 : http://mwultong.blogspot.com/2006/11/java-shift-jis-utf-8.html  


결과는 둘 다 실패... ^^

대충 실패하는 이유 감이 오긴 했다. 그러니까 애초에 

근데 iconv는 사실 mobaXterm에서 명령어 쓰면 파일 저장은 제대로 안되는데 또 자체 콘솔에서 찍히는 건 제대로 찍혀 나온다 ㅠㅠ 환장.  


그래서 또 다른 방법이 무엇이 있을까 하다가... 일전의 저 GBK to UFT extension 파일을 뜯어보면 어떨까.... 라는 생각이 들었다..

잠깐 또 삽질했는데 extension 파일 경로는 vscode 설치 경로가 아닌 Users의 .vscode의 하위 extension 이다.

C:\Users\{userdesktop}\.vscode\extensions 


까보니 타입스크립트 파일이다. 
https://code.visualstudio.com/api/get-started/your-first-extension 에 소개한 대로 vscode plugin 제작이 가이드가 잘 되어있는데
타입추론이 가능한 타입스크립트를 주로 추천한다고 한다.

기왕 이렇게 된거... 하도 오래 전에 써서 까먹었던 node.js 와 어쨌든 대세인 typescript, 언젠가 해야할 이거 지금 해보기로 한다 ㅡㅡ 

핸드북을 찾아 읽는다. https://typescript-kr.github.io/pages/tutorials/typescript-in-5-minutes.html



- 정규식 문제

계속 찾는 사항.
최소 검색은 ```.*?```  
```(name=").*?(")```


## 스크립트 번역


### 번역 문제

- 파파고 번역 API

- 크롬 브라우저 번역 매크로


### 번역 후처리

- myDic 단어사전 적용



### 기타문제

- 도커 등 서버 띄워 내부 작동하기

컨버팅 작업, 수동 컨버팅 작업, 수동 번역 작업의 경우 컴퓨터 키 혹은 클릭 자원을 소모하기 때문에 어쩔 수 없이 컴퓨터 한대를 점유한다.
이걸 동시에 돌릴 수 있는 방법 없을까? -> 가상 데스크탑을 띄워 화면 분할했지만 키나 매크로는 전역으로 돌아서 실패..  

그렇다면... 리눅스 서버나 가상 이미지를 띄워서 돌려보면 어떨까?

- 윈도우 파일 이름 다중처리

cmd에서 간단하게 하는 법

``ren *.jpg *.gif`` 




## 일지

- 2022-03-05   
  대량 컨버팅, 사전 적용 완료  
  자바 이용한 컨버팅 파일 자동 저장 완료
  크롬 브라우저 이용한 번역 수동 다운 페이지 생성

- 2022-03-05  
  자바 프로젝트 추가  
  ConvertV4 작성(프로미스 실패), TranslateV1, myDicV1 작성
  파파고 번역 자동화를 위한 서버단 추가
  프로젝트 설정 엉켜서 다 날리고 스프링 프로젝트로 새로 작성

- 2022-03-04  
  프로젝트 생성  
  ConvertV1, V2, V3 작성
  vanilaJS 통한 퀸로제 스크립트 -> 지시문 제외 대사 추출 정규식 적용  
  txt 파일 업로드 및 컨버팅 된 파일 다운로드 지원